<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug localStorage</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .error { color: red; }
        .success { color: green; }
        .info { color: blue; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üîç Debug localStorage</h1>
    
    <div class="debug-section">
        <h2>1. –ü—Ä–æ–≤–µ—Ä–∫–∞ localStorage</h2>
        <div id="localStorageInfo"></div>
    </div>
    
    <div class="debug-section">
        <h2>2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–µ–π</h2>
        <div id="keysInfo"></div>
    </div>
    
    <div class="debug-section">
        <h2>3. –î–∞–Ω–Ω—ã–µ –¥–æ–º–µ–Ω–æ–≤</h2>
        <div id="domainsInfo"></div>
    </div>
    
    <div class="debug-section">
        <h2>4. –¢–µ—Å—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–æ–º–µ–Ω–∞</h2>
        <button onclick="addTestDomain()">–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –¥–æ–º–µ–Ω</button>
        <div id="testResult"></div>
    </div>

    <script>
        function debugLocalStorage() {
            console.log('üîç –ù–∞—á–∏–Ω–∞–µ–º –æ—Ç–ª–∞–¥–∫—É localStorage...');
            
            // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å localStorage
            const localStorageInfo = document.getElementById('localStorageInfo');
            try {
                if (typeof(Storage) !== "undefined") {
                    localStorageInfo.innerHTML = '<p class="success">‚úÖ localStorage –¥–æ—Å—Ç—É–ø–µ–Ω</p>';
                } else {
                    localStorageInfo.innerHTML = '<p class="error">‚ùå localStorage –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</p>';
                    return;
                }
            } catch (e) {
                localStorageInfo.innerHTML = `<p class="error">‚ùå –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ localStorage: ${e.message}</p>`;
                return;
            }
            
            // 2. –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –∫–ª—é—á–∏
            const keysInfo = document.getElementById('keysInfo');
            try {
                const keys = Object.keys(localStorage);
                keysInfo.innerHTML = `
                    <p class="info">üìã –í—Å–µ–≥–æ –∫–ª—é—á–µ–π: ${keys.length}</p>
                    <pre>${keys.map(key => `"${key}"`).join('\n')}</pre>
                `;
            } catch (e) {
                keysInfo.innerHTML = `<p class="error">‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–ª—é—á–µ–π: ${e.message}</p>`;
            }
            
            // 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–æ–º–µ–Ω–æ–≤
            const domainsInfo = document.getElementById('domainsInfo');
            try {
                const domainsData = localStorage.getItem('keyso_saved_domains');
                if (domainsData) {
                    const domains = JSON.parse(domainsData);
                    domainsInfo.innerHTML = `
                        <p class="success">‚úÖ –î–∞–Ω–Ω—ã–µ –¥–æ–º–µ–Ω–æ–≤ –Ω–∞–π–¥–µ–Ω—ã</p>
                        <p class="info">üìä –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–º–µ–Ω–æ–≤: ${domains.length}</p>
                        <pre>${JSON.stringify(domains, null, 2)}</pre>
                    `;
                } else {
                    domainsInfo.innerHTML = '<p class="error">‚ùå –î–∞–Ω–Ω—ã–µ –¥–æ–º–µ–Ω–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
                }
            } catch (e) {
                domainsInfo.innerHTML = `<p class="error">‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤: ${e.message}</p>`;
            }
        }
        
        function addTestDomain() {
            const testResult = document.getElementById('testResult');
            try {
                // –ü–æ–ª—É—á–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–æ–º–µ–Ω—ã
                let domains = [];
                const existingData = localStorage.getItem('keyso_saved_domains');
                if (existingData) {
                    domains = JSON.parse(existingData);
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –¥–æ–º–µ–Ω
                const testDomain = {
                    id: Date.now().toString(),
                    domain: 'test-domain.ru',
                    description: '–¢–µ—Å—Ç–æ–≤—ã–π –¥–æ–º–µ–Ω –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏',
                    tags: ['—Ç–µ—Å—Ç', '–ø—Ä–æ–≤–µ—Ä–∫–∞'],
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                domains.push(testDomain);
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±—Ä–∞—Ç–Ω–æ
                localStorage.setItem('keyso_saved_domains', JSON.stringify(domains));
                
                testResult.innerHTML = `
                    <p class="success">‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π –¥–æ–º–µ–Ω –¥–æ–±–∞–≤–ª–µ–Ω</p>
                    <p class="info">üìä –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–º–µ–Ω–æ–≤: ${domains.length}</p>
                `;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                setTimeout(debugLocalStorage, 100);
                
            } catch (e) {
                testResult.innerHTML = `<p class="error">‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–æ–º–µ–Ω–∞: ${e.message}</p>`;
            }
        }
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –æ—Ç–ª–∞–¥–∫—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', debugLocalStorage);
    </script>
</body>
</html>
