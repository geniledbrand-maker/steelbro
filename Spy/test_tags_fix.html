<!-- File: Spy/test_tags_fix.html -->
<!-- Created: 2025-01-22 -->
<!-- Modified: 2025-01-22 -->

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ–≥–æ–≤ - SteelBro</title>
    
    <!-- CSS –º–æ–¥—É–ª–∏ -->
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/sidebar.css">
    <link rel="stylesheet" href="assets/css/modal.css">
    
    <style>
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: white;
        }
        
        .test-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }
        
        .debug-info {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            margin: 10px 0;
            white-space: pre-wrap;
        }
        
        .test-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        .test-button:hover {
            background: #5a6fd8;
        }
        
        .success {
            color: #2e7d32;
            background: #e8f5e8;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .error {
            color: #d32f2f;
            background: #ffebee;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üîß –¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ–≥–æ–≤</h1>
        
        <div class="test-section">
            <div class="test-title">1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è DomainStorage</div>
            <button class="test-button" onclick="testDomainStorageFix()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</button>
            <div id="storageTestResult" class="debug-info"></div>
        </div>
        
        <div class="test-section">
            <div class="test-title">2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–≥–æ–≤</div>
            <button class="test-button" onclick="testTagDisplay()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ</button>
            <div id="displayTestResult" class="debug-info"></div>
        </div>
        
        <div class="test-section">
            <div class="test-title">3. –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏</div>
            <button class="test-button" onclick="fullTest()">–ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç</button>
            <div id="fullTestResult" class="debug-info"></div>
        </div>
        
        <div class="test-section">
            <div class="test-title">4. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–æ–º–µ–Ω–æ–≤ —Å —Ç–µ–≥–∞–º–∏</div>
            <div id="domainsDisplay"></div>
        </div>
    </div>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ -->
    <script src="classes/DomainManager/DomainStorage.js"></script>
    <script src="classes/DomainManager/DomainUI.js"></script>
    
    <script>
        // –¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è DomainStorage
        function testDomainStorageFix() {
            const result = document.getElementById('storageTestResult');
            
            try {
                if (typeof DomainStorage === 'undefined') {
                    result.textContent = '–û–®–ò–ë–ö–ê: DomainStorage –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω';
                    return;
                }
                
                const storage = new DomainStorage();
                
                // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –¥–æ–º–µ–Ω
                const testDomain = storage.addDomain({
                    domain: 'test-fix.com',
                    description: '–¢–µ—Å—Ç–æ–≤—ã–π –¥–æ–º–µ–Ω –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è',
                    tags: ['—Ç–µ—Å—Ç', '–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ', '—Ç–µ–≥–∏']
                });
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ–º–µ–Ω —Å –ø—É—Å—Ç—ã–º–∏ —Ç–µ–≥–∞–º–∏
                const updatedDomain = storage.updateDomain(testDomain.id, {
                    domain: 'test-fix.com',
                    description: '–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –¥–æ–º–µ–Ω',
                    tags: [] // –ü—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ —Ç–µ–≥–æ–≤
                });
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                if (updatedDomain && Array.isArray(updatedDomain.tags) && updatedDomain.tags.length === 0) {
                    result.textContent = '‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –†–ê–ë–û–¢–ê–ï–¢!\n' +
                        '–¢–µ–≥–∏ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –Ω–∞ –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤.\n' +
                        '–î–æ–º–µ–Ω: ' + updatedDomain.domain + '\n' +
                        '–¢–µ–≥–∏: ' + JSON.stringify(updatedDomain.tags);
                } else {
                    result.textContent = '‚ùå –û–®–ò–ë–ö–ê: –¢–µ–≥–∏ –Ω–µ –æ–±–Ω–æ–≤–∏–ª–∏—Å—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ\n' +
                        '–û–∂–∏–¥–∞–ª–æ—Å—å: []\n' +
                        '–ü–æ–ª—É—á–µ–Ω–æ: ' + JSON.stringify(updatedDomain.tags);
                }
                
            } catch (error) {
                result.textContent = '–û–®–ò–ë–ö–ê: ' + error.message;
            }
        }
        
        // –¢–µ—Å—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–≥–æ–≤
        function testTagDisplay() {
            const result = document.getElementById('displayTestResult');
            
            try {
                if (typeof DomainUI === 'undefined') {
                    result.textContent = '–û–®–ò–ë–ö–ê: DomainUI –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω';
                    return;
                }
                
                const ui = new DomainUI();
                
                // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
                const testDomains = [
                    {
                        id: '1',
                        domain: 'with-tags.com',
                        description: '–î–æ–º–µ–Ω —Å —Ç–µ–≥–∞–º–∏',
                        tags: ['—Ç–µ–≥1', '—Ç–µ–≥2', '—Ç–µ–≥3']
                    },
                    {
                        id: '2',
                        domain: 'no-tags.com',
                        description: '–î–æ–º–µ–Ω –±–µ–∑ —Ç–µ–≥–æ–≤',
                        tags: []
                    },
                    {
                        id: '3',
                        domain: 'null-tags.com',
                        description: '–î–æ–º–µ–Ω —Å null —Ç–µ–≥–∞–º–∏',
                        tags: null
                    }
                ];
                
                // –¢–µ—Å—Ç–∏—Ä—É–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                const container = document.createElement('div');
                ui.renderDomainList(testDomains, null, container);
                
                const html = container.innerHTML;
                const hasTags = html.includes('domain-tags');
                const hasTagSpans = html.includes('class="tag"');
                
                result.textContent = '–†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è:\n' +
                    'HTML —Å–æ–¥–µ—Ä–∂–∏—Ç .domain-tags: ' + hasTags + '\n' +
                    'HTML —Å–æ–¥–µ—Ä–∂–∏—Ç .tag: ' + hasTagSpans + '\n' +
                    '–î–ª–∏–Ω–∞ HTML: ' + html.length + ' —Å–∏–º–≤–æ–ª–æ–≤\n' +
                    '–ü–µ—Ä–≤—ã–µ 500 —Å–∏–º–≤–æ–ª–æ–≤ HTML:\n' + html.substring(0, 500);
                
            } catch (error) {
                result.textContent = '–û–®–ò–ë–ö–ê: ' + error.message;
            }
        }
        
        // –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç
        function fullTest() {
            const result = document.getElementById('fullTestResult');
            
            try {
                // –û—á–∏—â–∞–µ–º localStorage
                localStorage.removeItem('domains');
                
                // –°–æ–∑–¥–∞–µ–º storage –∏ UI
                const storage = new DomainStorage();
                const ui = new DomainUI();
                
                // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–æ–º–µ–Ω—ã
                const domain1 = storage.addDomain({
                    domain: 'metal-company.ru',
                    description: '–ö–æ–º–ø–∞–Ω–∏—è –ø–æ –º–µ—Ç–∞–ª–ª–æ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º',
                    tags: ['–º–µ—Ç–∞–ª–ª', '–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏', '–ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ']
                });
                
                const domain2 = storage.addDomain({
                    domain: 'steel-supplier.com',
                    description: '–ü–æ—Å—Ç–∞–≤—â–∏–∫ —Å—Ç–∞–ª–∏',
                    tags: ['—Å—Ç–∞–ª—å', '–ø–æ—Å—Ç–∞–≤–∫–∏', '–æ–ø—Ç']
                });
                
                const domain3 = storage.addDomain({
                    domain: 'no-tags.com',
                    description: '–î–æ–º–µ–Ω –±–µ–∑ —Ç–µ–≥–æ–≤',
                    tags: []
                });
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ–º–µ–Ω —Å —Ç–µ–≥–∞–º–∏
                storage.updateDomain(domain1.id, {
                    domain: 'metal-company.ru',
                    description: '–û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –∫–æ–º–ø–∞–Ω–∏—è –ø–æ –º–µ—Ç–∞–ª–ª–æ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º',
                    tags: ['–º–µ—Ç–∞–ª–ª', '–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏', '–ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ', '–æ–±–Ω–æ–≤–ª–µ–Ω–æ']
                });
                
                // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –¥–æ–º–µ–Ω—ã
                const allDomains = storage.getAllDomains();
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–æ–º–µ–Ω—ã
                const container = document.getElementById('domainsDisplay');
                ui.renderDomainList(allDomains, null, container);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                const html = container.innerHTML;
                const tagsCount = (html.match(/class="tag"/g) || []).length;
                const domainsWithTags = allDomains.filter(d => d.tags && d.tags.length > 0).length;
                
                result.textContent = '‚úÖ –ü–û–õ–ù–´–ô –¢–ï–°–¢ –ó–ê–í–ï–†–®–ï–ù!\n' +
                    '–°–æ–∑–¥–∞–Ω–æ –¥–æ–º–µ–Ω–æ–≤: ' + allDomains.length + '\n' +
                    '–î–æ–º–µ–Ω–æ–≤ —Å —Ç–µ–≥–∞–º–∏: ' + domainsWithTags + '\n' +
                    '–¢–µ–≥–æ–≤ –≤ HTML: ' + tagsCount + '\n' +
                    '–í—Å–µ —Ç–µ–≥–∏: ' + storage.getAllTags().join(', ');
                
            } catch (error) {
                result.textContent = '–û–®–ò–ë–ö–ê: ' + error.message;
            }
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', function() {
            console.log('–¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ–≥–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω');
        });
    </script>
</body>
</html>

<!-- End of file: Spy/test_tags_fix.html -->
<!-- Last modified: 2025-01-22 -->
