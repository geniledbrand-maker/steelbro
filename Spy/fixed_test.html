<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keys.so Spy - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .test-container { max-width: 800px; margin: 0 auto; }
        .test-section { background: white; padding: 20px; margin: 10px 0; border-radius: 10px; }
        .test-result { margin: 5px 0; padding: 8px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .btn { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .btn:hover { background: #0056b3; }
        .btn-success { background: #28a745; }
        .btn-success:hover { background: #218838; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üîç Keys.so Spy - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç</h1>
        
        <div class="test-section">
            <h2>üß™ –¢–µ—Å—Ç –∫–Ω–æ–ø–∫–∏ "–î–æ–±–∞–≤–∏—Ç—å"</h2>
            <div id="buttonTest"></div>
            <button class="btn" onclick="testAddButton()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–Ω–æ–ø–∫—É</button>
        </div>
        
        <div class="test-section">
            <h2>üìä –î–µ—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥—É–ª–µ–π</h2>
            <div id="moduleTest"></div>
            <button class="btn" onclick="testModules()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥—É–ª–∏</button>
        </div>
        
        <div class="test-section">
            <h2>üîß –¢–µ—Å—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏</h2>
            <div id="functionalityTest"></div>
            <button class="btn" onclick="testFunctionality()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏</button>
        </div>
        
        <div class="test-section">
            <h2>üéØ –¢–µ—Å—Ç –∫–Ω–æ–ø–∫–∏ "–î–æ–±–∞–≤–∏—Ç—å" –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ</h2>
            <div id="mainPageTest"></div>
            <button class="btn btn-success" onclick="testMainPageButton()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É</button>
        </div>
    </div>

    <!-- –ó–∞–≥—Ä—É–∂–∞–µ–º –º–æ–¥—É–ª–∏ -->
    <script src="assets/js/utils.js"></script>
    <script src="classes/DomainManager/DomainStorage.js"></script>
    <script src="classes/DomainManager/DomainUI.js"></script>
    <script src="classes/DomainManager/DomainManager.js"></script>
    <script src="classes/Shared/NotificationManager.js"></script>

    <script>
        function addResult(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.textContent = message;
            container.appendChild(div);
        }

        function clearResults(containerId) {
            document.getElementById(containerId).innerHTML = '';
        }

        function testAddButton() {
            clearResults('buttonTest');
            addResult('buttonTest', 'üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å"...', 'info');
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ DomainUI
                if (typeof DomainUI !== 'undefined') {
                    const domainUI = new DomainUI();
                    addResult('buttonTest', '‚úÖ DomainUI —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ', 'success');
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–µ—Ç–æ–¥—ã
                    const methods = ['addDomain', 'showDomainModal', 'hideDomainModal', 'saveDomain'];
                    methods.forEach(method => {
                        if (typeof domainUI[method] === 'function') {
                            addResult('buttonTest', `‚úÖ –ú–µ—Ç–æ–¥ ${method} —Å—É—â–µ—Å—Ç–≤—É–µ—Ç`, 'success');
                        } else {
                            addResult('buttonTest', `‚ùå –ú–µ—Ç–æ–¥ ${method} –ù–ï —Å—É—â–µ—Å—Ç–≤—É–µ—Ç`, 'error');
                        }
                    });
                    
                    // –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–∫–∞–∑ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
                    try {
                        domainUI.showDomainModal();
                        addResult('buttonTest', '‚úÖ showDomainModal —Ä–∞–±–æ—Ç–∞–µ—Ç', 'success');
                        domainUI.hideDomainModal();
                        addResult('buttonTest', '‚úÖ hideDomainModal —Ä–∞–±–æ—Ç–∞–µ—Ç', 'success');
                    } catch (error) {
                        addResult('buttonTest', `‚ùå –û—à–∏–±–∫–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞: ${error.message}`, 'error');
                    }
                    
                } else {
                    addResult('buttonTest', '‚ùå DomainUI –ù–ï –∑–∞–≥—Ä—É–∂–µ–Ω', 'error');
                }
                
            } catch (error) {
                addResult('buttonTest', `‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: ${error.message}`, 'error');
            }
        }

        function testModules() {
            clearResults('moduleTest');
            addResult('moduleTest', 'üìä –¢–µ—Å—Ç–∏—Ä—É–µ–º –º–æ–¥—É–ª–∏...', 'info');
            
            const modules = [
                { name: 'Utils', test: () => typeof Utils !== 'undefined' },
                { name: 'DomainStorage', test: () => typeof DomainStorage !== 'undefined' },
                { name: 'DomainUI', test: () => typeof DomainUI !== 'undefined' },
                { name: 'DomainManager', test: () => typeof DomainManager !== 'undefined' },
                { name: 'NotificationManager', test: () => typeof NotificationManager !== 'undefined' }
            ];
            
            let successCount = 0;
            modules.forEach(module => {
                try {
                    if (module.test()) {
                        addResult('moduleTest', `‚úÖ ${module.name} - –∑–∞–≥—Ä—É–∂–µ–Ω`, 'success');
                        successCount++;
                    } else {
                        addResult('moduleTest', `‚ùå ${module.name} - –ù–ï –∑–∞–≥—Ä—É–∂–µ–Ω`, 'error');
                    }
                } catch (error) {
                    addResult('moduleTest', `‚ùå ${module.name} - –æ—à–∏–±–∫–∞: ${error.message}`, 'error');
                }
            });
            
            addResult('moduleTest', `üìä –†–µ–∑—É–ª—å—Ç–∞—Ç: ${successCount}/${modules.length} –º–æ–¥—É–ª–µ–π –∑–∞–≥—Ä—É–∂–µ–Ω–æ`, 'info');
        }

        function testFunctionality() {
            clearResults('functionalityTest');
            addResult('functionalityTest', 'üîß –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å...', 'info');
            
            try {
                // –¢–µ—Å—Ç —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —á–∏—Å–µ–ª (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π)
                if (typeof Utils !== 'undefined') {
                    const testNumber = 1234567;
                    const formatted = Utils.formatNumber(testNumber);
                    const expected = '1 234 567';
                    
                    if (formatted === expected) {
                        addResult('functionalityTest', `‚úÖ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∏—Å–µ–ª —Ä–∞–±–æ—Ç–∞–µ—Ç: ${formatted}`, 'success');
                    } else {
                        addResult('functionalityTest', `‚ö†Ô∏è –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∏—Å–µ–ª: –ø–æ–ª—É—á–µ–Ω–æ "${formatted}", –æ–∂–∏–¥–∞–ª–æ—Å—å "${expected}"`, 'error');
                    }
                    
                    // –¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–æ–º–µ–Ω–æ–≤
                    const validDomain = Utils.validateDomain('example.com');
                    const invalidDomain = Utils.validateDomain('invalid..domain');
                    
                    if (validDomain) {
                        addResult('functionalityTest', '‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–æ–º–µ–Ω–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç (–≤–∞–ª–∏–¥–Ω—ã–π –¥–æ–º–µ–Ω)', 'success');
                    } else {
                        addResult('functionalityTest', '‚ùå –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–æ–º–µ–Ω–æ–≤ –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç (–≤–∞–ª–∏–¥–Ω—ã–π –¥–æ–º–µ–Ω)', 'error');
                    }
                    
                    if (!invalidDomain) {
                        addResult('functionalityTest', '‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–æ–º–µ–Ω–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç (–Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π –¥–æ–º–µ–Ω)', 'success');
                    } else {
                        addResult('functionalityTest', '‚ùå –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–æ–º–µ–Ω–æ–≤ –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç (–Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π –¥–æ–º–µ–Ω)', 'error');
                    }
                } else {
                    addResult('functionalityTest', '‚ùå Utils –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω', 'error');
                }
                
                // –¢–µ—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
                if (typeof notificationManager !== 'undefined') {
                    notificationManager.success('–¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ');
                    addResult('functionalityTest', '‚úÖ –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç', 'success');
                } else {
                    addResult('functionalityTest', '‚ùå notificationManager –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
                }
                
            } catch (error) {
                addResult('functionalityTest', `‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: ${error.message}`, 'error');
            }
        }

        function testMainPageButton() {
            clearResults('mainPageTest');
            addResult('mainPageTest', 'üéØ –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–Ω–æ–ø–∫—É –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ...', 'info');
            
            // –û—Ç–∫—Ä—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            const newWindow = window.open('index.html', '_blank');
            
            if (newWindow) {
                newWindow.addEventListener('load', function() {
                    try {
                        const addBtn = newWindow.document.getElementById('addDomainBtn');
                        if (addBtn) {
                            addResult('mainPageTest', '‚úÖ –ö–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å" –Ω–∞–π–¥–µ–Ω–∞ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ', 'success');
                            
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∏–ª–∏
                            const styles = newWindow.getComputedStyle(addBtn);
                            addResult('mainPageTest', `‚úÖ –ö–Ω–æ–ø–∫–∞ –≤–∏–¥–∏–º–∞: ${styles.display !== 'none'}`, 'success');
                            
                            // –¢–µ—Å—Ç–∏—Ä—É–µ–º –∫–ª–∏–∫
                            addBtn.click();
                            addResult('mainPageTest', '‚úÖ –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ –≤—ã–ø–æ–ª–Ω–µ–Ω', 'success');
                            
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ—è–≤–∏–ª–æ—Å—å –ª–∏ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                            setTimeout(() => {
                                const modal = newWindow.document.getElementById('domainModal');
                                if (modal && modal.classList.contains('active')) {
                                    addResult('mainPageTest', '‚úÖ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ—Ç–∫—Ä—ã–ª–æ—Å—å', 'success');
                                } else {
                                    addResult('mainPageTest', '‚ùå –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ù–ï –æ—Ç–∫—Ä—ã–ª–æ—Å—å', 'error');
                                }
                            }, 100);
                            
                        } else {
                            addResult('mainPageTest', '‚ùå –ö–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å" –ù–ï –Ω–∞–π–¥–µ–Ω–∞ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ', 'error');
                        }
                    } catch (error) {
                        addResult('mainPageTest', `‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã: ${error.message}`, 'error');
                    }
                });
            } else {
                addResult('mainPageTest', '‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É', 'error');
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫
        document.addEventListener('DOMContentLoaded', function() {
            addResult('buttonTest', 'üöÄ –ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –∫–Ω–æ–ø–∫–∏ "–î–æ–±–∞–≤–∏—Ç—å"', 'info');
            addResult('moduleTest', 'üìä –ì–æ—Ç–æ–≤ –∫ –ø—Ä–æ–≤–µ—Ä–∫–µ –º–æ–¥—É–ª–µ–π', 'info');
            addResult('functionalityTest', 'üîß –ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é —Ñ—É–Ω–∫—Ü–∏–π', 'info');
            addResult('mainPageTest', 'üéØ –ì–æ—Ç–æ–≤ –∫ –ø—Ä–æ–≤–µ—Ä–∫–µ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã', 'info');
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
            setTimeout(() => {
                testModules();
                testFunctionality();
            }, 1000);
        });
    </script>
</body>
</html>
