<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keys.so - –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤</title>
    
    <!-- CSS –º–æ–¥—É–ª–∏ -->
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/sidebar.css">
    <link rel="stylesheet" href="assets/css/modal.css">
    <link rel="stylesheet" href="assets/css/tables.css">
</head>
<body>

<!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å –¥–æ–º–µ–Ω–∞–º–∏ -->
<div class="sidebar">
    <h2>
        üìÅ –°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –¥–æ–º–µ–Ω—ã
        <span id="domainCounter">0</span>
    </h2>

    <div class="sidebar-actions">
        <button class="sidebar-btn" id="addDomainBtn">+ –î–æ–±–∞–≤–∏—Ç—å</button>
        <button class="sidebar-btn secondary" id="exportDomainsBtn">üì•</button>
        <button class="sidebar-btn secondary" id="importDomainsBtn">üì§</button>
    </div>

    <div class="domain-list" id="domainList">
        <div class="empty-state">
            <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤</p>
            <p style="font-size: 12px; margin-top: 10px;">–î–æ–±–∞–≤—å—Ç–µ –¥–æ–º–µ–Ω—ã –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞</p>
        </div>
    </div>
</div>

<!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
<div class="main-content">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="header">
        <h1>üîç Keys.so - –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤</h1>

        <div class="api-status">
            <div class="api-indicator" id="apiIndicator"></div>
            <span id="apiStatusText">API —Å—Ç–∞—Ç—É—Å</span>
            <button class="api-check-btn" id="checkApiBtn" style="padding:6px 12px;background:#fff;border:1px solid #ddd;border-radius:6px;cursor:pointer;font-size:13px;margin-left:auto;">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
        </div>

        <form class="search-form" id="searchForm">
            <input type="text" id="domainInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –¥–æ–º–µ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä: dns-shop.ru)" required>
            <select id="regionSelect">
                <option value="msk">–ú–æ—Å–∫–≤–∞</option>
                <option value="spb">–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥</option>
                <option value="ekb">–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥</option>
                <option value="nsk">–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫</option>
                <option value="kzn">–ö–∞–∑–∞–Ω—å</option>
            </select>
            <button type="submit" id="analyzeBtn">–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å</button>
        </form>
    </div>

    <!-- –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö -->
    <div id="errorMessage"></div>

    <!-- –í–∫–ª–∞–¥–∫–∏ -->
    <div class="tabs">
        <button class="tab active" data-tab="overview">üìä –û–±–∑–æ—Ä</button>
        <button class="tab" data-tab="keywords">üîë –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞</button>
        <button class="tab" data-tab="pages">üìÑ –°—Ç—Ä–∞–Ω–∏—Ü—ã</button>
        <button class="tab" data-tab="ads">üí∞ –†–µ–∫–ª–∞–º–∞</button>
        <button class="tab" data-tab="competitors">ü•ä –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç—ã</button>
    </div>

    <!-- –°–µ–∫—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ -->
    <div id="overview" class="content-section active">
        <div id="overviewContent"></div>
    </div>

    <div id="keywords" class="content-section">
        <div id="keywordsContent"></div>
    </div>

    <div id="pages" class="content-section">
        <div id="pagesContent"></div>
    </div>

    <div id="ads" class="content-section">
        <div id="adsContent"></div>
    </div>

    <div id="competitors" class="content-section">
        <div id="competitorsContent"></div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–º–µ–Ω–æ–≤ -->
<div class="modal" id="domainModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modalTitle">–î–æ–±–∞–≤–∏—Ç—å –¥–æ–º–µ–Ω</h3>
            <button class="close-modal" id="closeModalBtn">√ó</button>
        </div>

        <div class="form-group">
            <label for="modalDomainInput">–î–æ–º–µ–Ω *</label>
            <input type="text" id="modalDomainInput" placeholder="example.com" required>
        </div>

        <div class="form-group">
            <label for="modalDescriptionInput">–û–ø–∏—Å–∞–Ω–∏–µ</label>
            <textarea id="modalDescriptionInput" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–æ–º–µ–Ω–∞ –∏–ª–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞"></textarea>
        </div>

        <div class="form-group">
            <label>–¢–µ–≥–∏</label>
            <div class="tags-input-container" id="tagsContainer">
                <input type="text" class="tags-input" id="tagsInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–≥ –∏ –Ω–∞–∂–º–∏—Ç–µ Enter">
            </div>
        </div>

        <div class="modal-actions">
            <button class="modal-btn secondary" id="cancelModalBtn">–û—Ç–º–µ–Ω–∞</button>
            <button class="modal-btn primary" id="saveDomainBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>
</div>

<!-- –°–∫—Ä—ã—Ç—ã–π input –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ —Ñ–∞–π–ª–æ–≤ -->
<input type="file" id="importFileInput" style="display: none;" accept=".json">

<!-- JavaScript –º–æ–¥—É–ª–∏ -->
<!-- –£—Ç–∏–ª–∏—Ç—ã -->
<script src="assets/js/utils.js"></script>

<!-- API -->
<script src="assets/js/api.js"></script>

<!-- Domain Manager -->
<script src="classes/DomainManager/DomainStorage.js"></script>
<script src="classes/DomainManager/DomainUI.js"></script>
<script src="classes/DomainManager/DomainManager.js"></script>

<!-- Shared -->
<script src="classes/Shared/TabManager.js"></script>
<script src="classes/Shared/ExportManager.js"></script>
<script src="classes/Shared/NotificationManager.js"></script>

<!-- Tabs -->
<script src="classes/Overview/OverviewTab.js"></script>
<script src="classes/Keywords/KeywordsTab.js"></script>

<!-- Main App (–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–º) -->
<script src="assets/js/app.js"></script>

<script>
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
document.addEventListener('DOMContentLoaded', function() {
    console.log('Keys.so Spy - –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ –º–æ–¥—É–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
    if (typeof Utils === 'undefined') {
        console.error('Utils –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
    }
    if (typeof DomainStorage === 'undefined') {
        console.error('DomainStorage –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
    }
    if (typeof DomainUI === 'undefined') {
        console.error('DomainUI –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
    }
    if (typeof DomainManager === 'undefined') {
        console.error('DomainManager –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
    }
    if (typeof TabManager === 'undefined') {
        console.error('TabManager –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
    }
    if (typeof ExportManager === 'undefined') {
        console.error('ExportManager –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
    }
    if (typeof NotificationManager === 'undefined') {
        console.error('NotificationManager –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
    }
    if (typeof OverviewTab === 'undefined') {
        console.error('OverviewTab –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
    }
    if (typeof KeywordsTab === 'undefined') {
        console.error('KeywordsTab –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
    }
    
    console.log('–í—Å–µ –º–æ–¥—É–ª–∏ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª–µ–π
    try {
        // –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –º–æ–¥—É–ª–µ–π
        const domainStorage = new DomainStorage();
        const domainUI = new DomainUI();
        const domainManager = new DomainManager(domainStorage, domainUI);
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º UI
        domainUI.init();
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –º–µ–Ω–µ–¥–∂–µ—Ä –¥–æ–º–µ–Ω–æ–≤
        domainManager.init();
        
        // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –∫ —Ñ—É–Ω–∫—Ü–∏—è–º
        const addDomainBtn = document.getElementById('addDomainBtn');
        const exportDomainsBtn = document.getElementById('exportDomainsBtn');
        const importDomainsBtn = document.getElementById('importDomainsBtn');
        
        if (addDomainBtn) {
            addDomainBtn.addEventListener('click', () => {
                domainUI.addDomain();
            });
        }
        
        if (exportDomainsBtn) {
            exportDomainsBtn.addEventListener('click', () => {
                domainUI.exportDomains();
            });
        }
        
        if (importDomainsBtn) {
            importDomainsBtn.addEventListener('click', () => {
                domainUI.importDomains();
            });
        }
        
        // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        const closeModalBtn = document.getElementById('closeModalBtn');
        const cancelModalBtn = document.getElementById('cancelModalBtn');
        const saveDomainBtn = document.getElementById('saveDomainBtn');
        
        if (closeModalBtn) {
            closeModalBtn.addEventListener('click', () => {
                domainUI.hideDomainModal();
            });
        }
        
        if (cancelModalBtn) {
            cancelModalBtn.addEventListener('click', () => {
                domainUI.hideDomainModal();
            });
        }
        
        if (saveDomainBtn) {
            saveDomainBtn.addEventListener('click', () => {
                domainUI.saveDomain();
            });
        }
        
        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        domainManager.on('notification', (data) => {
            if (typeof notificationManager !== 'undefined') {
                notificationManager[data.type](data.message);
            } else {
                console.log(`–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: ${data.type} - ${data.message}`);
            }
        });
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è API —Å—Ç–∞—Ç—É—Å–∞
        initializeApiStatus();
        
        console.log('‚úÖ –ú–æ–¥—É–ª–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ');
        
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –º–æ–¥—É–ª–µ–π:', error);
        
        // Fallback - –ø—Ä–æ—Å—Ç—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
        const addDomainBtn = document.getElementById('addDomainBtn');
        if (addDomainBtn) {
            addDomainBtn.addEventListener('click', () => {
                alert('–ú–æ–¥—É–ª–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏.');
            });
        }
    }
});

// –§—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ API —Å—Ç–∞—Ç—É—Å–∞
function initializeApiStatus() {
    const apiIndicator = document.getElementById('apiIndicator');
    const apiStatusText = document.getElementById('apiStatusText');
    const checkApiBtn = document.getElementById('checkApiBtn');
    
    if (!apiIndicator || !apiStatusText || !checkApiBtn) {
        console.error('–≠–ª–µ–º–µ–Ω—Ç—ã API —Å—Ç–∞—Ç—É—Å–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
        return;
    }
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å
    setApiStatus('unknown', 'API —Å—Ç–∞—Ç—É—Å');
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏
    checkApiBtn.addEventListener('click', checkApiStatus);
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    setTimeout(checkApiStatus, 1000);
}

// –§—É–Ω–∫—Ü–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ API
function setApiStatus(status, text) {
    const apiIndicator = document.getElementById('apiIndicator');
    const apiStatusText = document.getElementById('apiStatusText');
    
    if (!apiIndicator || !apiStatusText) return;
    
    // –£–¥–∞–ª—è–µ–º –≤—Å–µ –∫–ª–∞—Å—Å—ã —Å—Ç–∞—Ç—É—Å–∞ (–Ω–æ–≤—ã–µ –∏ –ª–µ–≥–∞—Å–∏)
    apiIndicator.classList.remove('api-status-unknown', 'api-status-checking', 'api-status-success', 'api-status-error', 'checking', 'success', 'error');
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∫–ª–∞—Å—Å
    apiIndicator.classList.add(`api-status-${status}`);
    apiStatusText.textContent = text;
    
    console.log(`API —Å—Ç–∞—Ç—É—Å: ${status} - ${text}`);
}

// –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ API —Å—Ç–∞—Ç—É—Å–∞
async function checkApiStatus() {
    setApiStatus('checking', '–ü—Ä–æ–≤–µ—Ä—è–µ–º...');
    try {
        // –î–µ—Ä–≥–∞–µ–º –∫–æ—Ä–Ω–µ–≤–æ–π –ø—Ä–æ–∫—Å–∏ —Å GET-–ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ (—Å–æ–≤–º–µ—Å—Ç–∏–º–æ —Å–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–µ–π OpenAPI)
        const url = '/keys_proxy.php?endpoint=/report/simple/domain_dashboard&domain=yandex.ru&base=msk';
        const response = await fetch(url, { method: 'GET' });

        if (response.ok) {
            setApiStatus('success', 'API —Ä–∞–±–æ—Ç–∞–µ—Ç');
            console.log('‚úÖ API –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–∞');
            return;
        }

        setApiStatus('error', '–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è');
        console.log('‚ùå –û—à–∏–±–∫–∞ HTTP:', response.status);
    } catch (error) {
        setApiStatus('error', 'API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
        console.log('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ API:', error.message);
    }
}
</script>

</body>
</html>
