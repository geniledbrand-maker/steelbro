<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keys.so - –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ (–ü—Ä–æ—Å—Ç–∞—è –≤–µ—Ä—Å–∏—è)</title>
    
    <!-- CSS –º–æ–¥—É–ª–∏ -->
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/sidebar.css">
    <link rel="stylesheet" href="assets/css/modal.css">
    <link rel="stylesheet" href="assets/css/tables.css">
</head>
<body>

<!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å –¥–æ–º–µ–Ω–∞–º–∏ -->
<div class="sidebar">
    <h2>
        üìÅ –°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –¥–æ–º–µ–Ω—ã
        <span id="domainCounter">0</span>
    </h2>

    <div class="sidebar-actions">
        <button class="sidebar-btn" id="addDomainBtn">+ –î–æ–±–∞–≤–∏—Ç—å</button>
        <button class="sidebar-btn secondary" id="exportDomainsBtn">üì•</button>
        <button class="sidebar-btn secondary" id="importDomainsBtn">üì§</button>
    </div>

    <div class="domain-list" id="domainList">
        <div class="empty-state">
            <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤</p>
            <p style="font-size: 12px; margin-top: 10px;">–î–æ–±–∞–≤—å—Ç–µ –¥–æ–º–µ–Ω—ã –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞</p>
        </div>
    </div>
</div>

<!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
<div class="main-content">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="header">
        <h1>üîç Keys.so - –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤</h1>

        <div class="api-status">
            <div class="api-indicator" id="apiIndicator"></div>
            <span id="apiStatusText">API —Å—Ç–∞—Ç—É—Å</span>
            <button class="api-check-btn" id="checkApiBtn" style="padding:6px 12px;background:#fff;border:1px solid #ddd;border-radius:6px;cursor:pointer;font-size:13px;margin-left:auto;">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
        </div>

        <form class="search-form" id="searchForm">
            <input type="text" id="domainInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –¥–æ–º–µ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä: dns-shop.ru)" required>
            <select id="regionSelect">
                <option value="msk">–ú–æ—Å–∫–≤–∞</option>
                <option value="spb">–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥</option>
                <option value="ekb">–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥</option>
                <option value="nsk">–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫</option>
                <option value="kzn">–ö–∞–∑–∞–Ω—å</option>
            </select>
            <button type="submit" id="analyzeBtn">–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å</button>
        </form>
    </div>

    <!-- –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö -->
    <div id="errorMessage"></div>

    <!-- –í–∫–ª–∞–¥–∫–∏ -->
    <div class="tabs">
        <button class="tab active" data-tab="overview">üìä –û–±–∑–æ—Ä</button>
        <button class="tab" data-tab="keywords">üîë –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞</button>
        <button class="tab" data-tab="pages">üìÑ –°—Ç—Ä–∞–Ω–∏—Ü—ã</button>
        <button class="tab" data-tab="ads">üí∞ –†–µ–∫–ª–∞–º–∞</button>
        <button class="tab" data-tab="competitors">ü•ä –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç—ã</button>
    </div>

    <!-- –°–µ–∫—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ -->
    <div id="overview" class="content-section active">
        <div id="overviewContent"></div>
    </div>

    <div id="keywords" class="content-section">
        <div id="keywordsContent"></div>
    </div>

    <div id="pages" class="content-section">
        <div id="pagesContent"></div>
    </div>

    <div id="ads" class="content-section">
        <div id="adsContent"></div>
    </div>

    <div id="competitors" class="content-section">
        <div id="competitorsContent"></div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–º–µ–Ω–æ–≤ -->
<div class="modal" id="domainModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modalTitle">–î–æ–±–∞–≤–∏—Ç—å –¥–æ–º–µ–Ω</h3>
            <button class="close-modal" id="closeModalBtn">√ó</button>
        </div>

        <div class="form-group">
            <label for="modalDomainInput">–î–æ–º–µ–Ω *</label>
            <input type="text" id="modalDomainInput" placeholder="example.com" required>
        </div>

        <div class="form-group">
            <label for="modalDescriptionInput">–û–ø–∏—Å–∞–Ω–∏–µ</label>
            <textarea id="modalDescriptionInput" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–æ–º–µ–Ω–∞ –∏–ª–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞"></textarea>
        </div>

        <div class="form-group">
            <label>–¢–µ–≥–∏</label>
            <div class="tags-input-container" id="tagsContainer">
                <input type="text" class="tags-input" id="tagsInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–≥ –∏ –Ω–∞–∂–º–∏—Ç–µ Enter">
            </div>
        </div>

        <div class="modal-actions">
            <button class="modal-btn secondary" id="cancelModalBtn">–û—Ç–º–µ–Ω–∞</button>
            <button class="modal-btn primary" id="saveDomainBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>
</div>

<!-- –°–∫—Ä—ã—Ç—ã–π input –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ —Ñ–∞–π–ª–æ–≤ -->
<input type="file" id="importFileInput" style="display: none;" accept=".json">

<script>
// –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –±–µ–∑ –º–æ–¥—É–ª–µ–π –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
let savedDomains = [];
let currentTags = [];
let editingDomainId = null;

// –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤
function loadSavedDomains() {
    const stored = localStorage.getItem('keyso_saved_domains');
    if (stored) {
        try {
            savedDomains = JSON.parse(stored);
        } catch (e) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–º–µ–Ω–æ–≤:', e);
            savedDomains = [];
        }
    }
}

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–æ–º–µ–Ω–æ–≤
function saveDomainsToDB() {
    localStorage.setItem('keyso_saved_domains', JSON.stringify(savedDomains));
}

// –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–ø–∏—Å–∫–∞ –¥–æ–º–µ–Ω–æ–≤
function renderDomainList() {
    const container = document.getElementById('domainList');
    const counter = document.getElementById('domainCounter');

    counter.textContent = savedDomains.length;

    if (savedDomains.length === 0) {
        container.innerHTML = '<div class="empty-state"><p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤</p><p style="font-size: 12px; margin-top: 10px;">–î–æ–±–∞–≤—å—Ç–µ –¥–æ–º–µ–Ω—ã –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞</p></div>';
        return;
    }

    container.innerHTML = savedDomains.map(domain => `
        <div class="domain-card" onclick="selectDomain('${domain.id}')">
            <div class="domain-card-header">
                <div class="domain-name">${domain.domain}</div>
                <div class="domain-actions">
                    <button class="icon-btn" onclick="event.stopPropagation(); editDomain('${domain.id}')" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</button>
                    <button class="icon-btn" onclick="event.stopPropagation(); deleteDomain('${domain.id}')" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</button>
                </div>
            </div>
            ${domain.description ? '<div class="domain-description">' + domain.description + '</div>' : ''}
            ${domain.tags && domain.tags.length > 0 ? '<div class="domain-tags">' + domain.tags.map(tag => '<span class="tag">' + tag + '</span>').join('') + '</div>' : ''}
        </div>
    `).join('');
}

// –ü–æ–∫–∞–∑ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
function showDomainModal(domain = null) {
    const modal = document.getElementById('domainModal');
    const title = document.getElementById('modalTitle');
    const domainInput = document.getElementById('modalDomainInput');
    const descriptionInput = document.getElementById('modalDescriptionInput');

    editingDomainId = domain ? domain.id : null;
    currentTags = domain ? [...(domain.tags || [])] : [];

    title.textContent = domain ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–æ–º–µ–Ω' : '–î–æ–±–∞–≤–∏—Ç—å –¥–æ–º–µ–Ω';
    domainInput.value = domain ? domain.domain : '';
    descriptionInput.value = domain ? (domain.description || '') : '';

    renderModalTags();
    modal.classList.add('active');
}

// –°–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
function hideDomainModal() {
    const modal = document.getElementById('domainModal');
    modal.classList.remove('active');
    editingDomainId = null;
    currentTags = [];
}

// –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ç–µ–≥–æ–≤
function renderModalTags() {
    const container = document.getElementById('tagsContainer');
    const currentInput = document.getElementById('tagsInput');
    const inputValue = currentInput ? currentInput.value : '';

    container.innerHTML = currentTags.map(tag => `
        <span class="tag-item">
            ${tag}
            <button class="tag-remove" onclick="removeTag('${tag}')">√ó</button>
        </span>
    `).join('') + `
        <input type="text" class="tags-input" id="tagsInput" 
               placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–≥ –∏ –Ω–∞–∂–º–∏—Ç–µ Enter" value="${inputValue}">
    `;

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –¥–ª—è –≤–≤–æ–¥–∞ —Ç–µ–≥–æ–≤
    const newInput = document.getElementById('tagsInput');
    if (newInput) {
        newInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                const tag = e.target.value.trim();
                if (tag && !currentTags.includes(tag)) {
                    currentTags.push(tag);
                    renderModalTags();
                }
            }
        });
    }
}

// –£–¥–∞–ª–µ–Ω–∏–µ —Ç–µ–≥–∞
function removeTag(tag) {
    currentTags = currentTags.filter(t => t !== tag);
    renderModalTags();
}

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–æ–º–µ–Ω–∞
function saveDomain() {
    const domainInput = document.getElementById('modalDomainInput');
    const descriptionInput = document.getElementById('modalDescriptionInput');

    const domain = domainInput.value.trim().replace(/^https?:\/\//, '');
    const description = descriptionInput.value.trim();

    if (!domain) {
        alert('–í–≤–µ–¥–∏—Ç–µ –¥–æ–º–µ–Ω');
        return;
    }

    if (editingDomainId) {
        const index = savedDomains.findIndex(d => d.id === editingDomainId);
        if (index !== -1) {
            savedDomains[index] = {
                ...savedDomains[index],
                domain,
                description,
                tags: [...currentTags],
                updatedAt: new Date().toISOString()
            };
        }
    } else {
        const newDomain = {
            id: Date.now().toString(),
            domain,
            description,
            tags: [...currentTags],
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString()
        };
        savedDomains.unshift(newDomain);
    }

    saveDomainsToDB();
    renderDomainList();
    hideDomainModal();
    alert(editingDomainId ? '–î–æ–º–µ–Ω –æ–±–Ω–æ–≤–ª—ë–Ω' : '–î–æ–º–µ–Ω –¥–æ–±–∞–≤–ª–µ–Ω');
}

// –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–º–µ–Ω–∞
function editDomain(id) {
    const domain = savedDomains.find(d => d.id === id);
    if (!domain) return;
    showDomainModal(domain);
}

// –£–¥–∞–ª–µ–Ω–∏–µ –¥–æ–º–µ–Ω–∞
function deleteDomain(id) {
    if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –¥–æ–º–µ–Ω –∏–∑ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö?')) {
        savedDomains = savedDomains.filter(d => d.id !== id);
        saveDomainsToDB();
        renderDomainList();
        alert('–î–æ–º–µ–Ω —É–¥–∞–ª—ë–Ω');
    }
}

// –í—ã–±–æ—Ä –¥–æ–º–µ–Ω–∞
function selectDomain(id) {
    const domain = savedDomains.find(d => d.id === id);
    if (!domain) return;

    document.getElementById('domainInput').value = domain.domain;
    renderDomainList();
}

// –≠–∫—Å–ø–æ—Ä—Ç –¥–æ–º–µ–Ω–æ–≤
function exportDomains() {
    if (savedDomains.length === 0) {
        alert('–ù–µ—Ç –¥–æ–º–µ–Ω–æ–≤ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞');
        return;
    }

    const dataStr = JSON.stringify(savedDomains, null, 2);
    const blob = new Blob([dataStr], { type: 'application/json' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'keyso_domains_' + new Date().toISOString().split('T')[0] + '.json';
    link.click();
    alert('–î–æ–º–µ–Ω—ã —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã');
}

// –ò–º–ø–æ—Ä—Ç –¥–æ–º–µ–Ω–æ–≤
function importDomains() {
    document.getElementById('importFileInput').click();
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ —Ñ–∞–π–ª–∞
function handleImportFile(event) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = (e) => {
        try {
            const imported = JSON.parse(e.target.result);
            if (!Array.isArray(imported)) {
                throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞');
            }

            const confirmed = confirm(`–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å ${imported.length} –¥–æ–º–µ–Ω–æ–≤? –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–æ–º–µ–Ω—ã –Ω–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.`);
            if (confirmed) {
                imported.forEach(domain => {
                    if (!savedDomains.find(d => d.domain === domain.domain)) {
                        savedDomains.push({
                            ...domain,
                            id: Date.now().toString() + Math.random(),
                            updatedAt: new Date().toISOString()
                        });
                    }
                });
                saveDomainsToDB();
                renderDomainList();
                alert(`–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –¥–æ–º–µ–Ω–æ–≤: ${imported.length}`);
            }
        } catch (error) {
            alert('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞: ' + error.message);
        }
    };
    reader.readAsText(file);
    event.target.value = '';
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
document.addEventListener('DOMContentLoaded', function() {
    console.log('Keys.so Spy - –ü—Ä–æ—Å—Ç–∞—è –≤–µ—Ä—Å–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –¥–æ–º–µ–Ω—ã
    loadSavedDomains();
    renderDomainList();
    
    // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    document.getElementById('addDomainBtn').addEventListener('click', () => showDomainModal());
    document.getElementById('exportDomainsBtn').addEventListener('click', exportDomains);
    document.getElementById('importDomainsBtn').addEventListener('click', importDomains);
    document.getElementById('closeModalBtn').addEventListener('click', hideDomainModal);
    document.getElementById('cancelModalBtn').addEventListener('click', hideDomainModal);
    document.getElementById('saveDomainBtn').addEventListener('click', saveDomain);
    document.getElementById('importFileInput').addEventListener('change', handleImportFile);
    
    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –µ–≥–æ
    document.getElementById('domainModal').addEventListener('click', (e) => {
        if (e.target === e.currentTarget) {
            hideDomainModal();
        }
    });
    
    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ Escape
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            hideDomainModal();
        }
    });
    
    console.log('‚úÖ –ü—Ä–æ—Å—Ç–∞—è –≤–µ—Ä—Å–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
});
</script>

</body>
</html>
